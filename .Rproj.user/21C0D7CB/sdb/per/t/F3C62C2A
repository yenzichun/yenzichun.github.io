{
    "collab_server" : "",
    "contents" : "library(\"shiny\")\nrequire(\"highcharter\")\nload(file = \"ems_city_group_data.rda\")\n\n\nenc2native(city_group_count$city2) ## 變成<U+00BC><ea><U+00B4><f2><U+00BF><U+00A4>\nEncoding(city_group_count$city2) <- \"CP950\" ## 轉成正常中文\ncity_group_count$city2 <- iconv(city_group_count$city2,\"CP950\",\"UTF-8\")\n#print(Encoding(city_group_count$city2))\n\n# UI function\nui <- fluidPage(\n  navbarPage( \"EMS Project\",\n        tabPanel(\"city-case histogram\",\n                  wellPanel(\n                    highchartOutput(\"hcontainer1\",height = \"500px\")\n                  )\n        ),\n\n        tabPanel(\"year-case histogram\",\n                 wellPanel(\n                   highchartOutput(\"hcontainer2\",height = \"500px\")\n                 )\n        )\n  )\n)\n\n# Server function\nserver <- function(input, output, session) {\n  require(\"highcharter\")\n  require(\"dplyr\")\n  # l1 <- city_group_count %>% filter(yy==2007)\n  # l2 <- city_group_count %>% filter(yy==2008)\n  # l3 <- city_group_count %>% filter(yy==2009)\n  # l4 <- city_group_count %>% filter(yy==2010)\n  # l5 <- city_group_count %>% filter(yy==2011)\n  # l6 <- city_group_count %>% filter(yy==2012)\n  # l7 <- city_group_count %>% filter(yy==2013)\n  #citylist <- levels(as.factor(city_group_count$city2))\n\n  yrlist <- paste0(levels(as.factor(city_group_count$yy)),\"yr\")\n  Encoding(yrlist) <- \"CP950\" ## 轉成正常中文\n  yrlist <- iconv(yrlist,\"CP950\",\"UTF-8\")\n\n  require(\"tidyr\")\n  y <- city_group_count %>% spread(.,city2,count,fill=0) ### 預設缺值會補NA, 為了後面畫圖正確補0\n\n  citylist2 <- colnames(y)[-1]\n  colnames(y) <- rep(letters,1,length(names(y)))\n\n  output$hcontainer1 <- renderHighchart({\n\n    highchart() %>%\n      hc_chart(type = \"column\") %>%\n      hc_title(text = \"Stacked Column Chart\") %>%\n      hc_subtitle(text = \"* click the label below to enable/disable specific year data\",\n                  align = \"right\") %>%\n      hc_xAxis( categories = rep(citylist2,1,length(citylist2))) %>%\n      # categories=citylist不知道為什麼上傳到shinyapps.io後順序有問題\n      hc_yAxis( stackLabels = list( enabled = TRUE)) %>% ## 為上面出現總和\n      hc_plotOptions( column = list( stacking = \"normal\")) %>%\n      hc_add_series(name=yrlist[7],data = as.numeric(y[7,-1])) %>%\n      hc_add_series(name=yrlist[6],data = as.numeric(y[6,-1])) %>%\n      hc_add_series(name=yrlist[5],data = as.numeric(y[5,-1])) %>%\n      hc_add_series(name=yrlist[4],data = as.numeric(y[4,-1])) %>%\n      hc_add_series(name=yrlist[3],data = as.numeric(y[3,-1])) %>%\n      hc_add_series(name=yrlist[2],data = as.numeric(y[2,-1])) %>%\n      hc_add_series(name=yrlist[1],data = as.numeric(y[1,-1]))\n\n      # hc_legend(align=\"right\", x=-30, verticalAlign=\"top\",y=25,floating=TRUE,borderColor=\"black\",shodow=FALSE)\n      # 類別圖標\n\n      # hc_add_series(name=yrlist[7],data = l7$count) %>%\n      # hc_add_series(name=yrlist[6],data = l6$count) %>%\n      # hc_add_series(name=yrlist[5],data = l5$count) %>%\n      # hc_add_series(name=yrlist[4],data = l4$count) %>%\n      # hc_add_series(name=yrlist[3],data = l3$count) %>%\n      # hc_add_series(name=yrlist[2],data = l2$count) %>%\n      # hc_add_series(name=yrlist[1],data = l1$count)\n\n  })\n\n  output$hcontainer2 <- renderHighchart({\n\n    highchart() %>%\n      hc_chart(type = \"column\") %>%\n      hc_title(text = \"Stacked Column Chart\") %>%\n      hc_subtitle(text = \"* click the label below to enable/disable specific city data\",\n                  align = \"right\") %>%\n      hc_xAxis( categories = yrlist) %>%\n      hc_yAxis( stackLabels = list( enabled = TRUE)) %>%\n      hc_plotOptions( column = list( stacking = \"normal\")) %>%\n      hc_add_series(name=citylist2[1],data = y$b, visible = FALSE) %>%\n      hc_add_series(name=citylist2[2],data = y$c, visible = FALSE) %>%\n      hc_add_series(name=citylist2[3],data = y$d, visible = FALSE) %>%\n      hc_add_series(name=citylist2[4],data = y$e, visible = FALSE) %>%\n      hc_add_series(name=citylist2[5],data = y$f, visible = FALSE) %>%\n      hc_add_series(name=citylist2[6],data = y$g, visible = FALSE) %>%\n      hc_add_series(name=citylist2[7],data = y$h, visible = FALSE) %>%\n      hc_add_series(name=citylist2[8],data = y$i, visible = FALSE) %>%\n      hc_add_series(name=citylist2[9],data = y$j, visible = FALSE) %>%\n      hc_add_series(name=citylist2[10],data = y$k, visible = FALSE) %>%\n      hc_add_series(name=citylist2[11],data = y$l, visible = FALSE) %>%\n      hc_add_series(name=citylist2[12],data = y$m) %>%\n      hc_add_series(name=citylist2[13],data = y$n, visible = FALSE) %>%\n      hc_add_series(name=citylist2[14],data = y$o, visible = FALSE) %>%\n      hc_add_series(name=citylist2[15],data = y$p, visible = FALSE) %>%\n      hc_add_series(name=citylist2[16],data = y$q, visible = FALSE) %>%\n      hc_add_series(name=citylist2[17],data = y$r, visible = FALSE) %>%\n      hc_add_series(name=citylist2[18],data = y$s, visible = FALSE) %>%\n      hc_add_series(name=citylist2[19],data = y$t, visible = FALSE) %>%\n      hc_add_series(name=citylist2[20],data = y$u, visible = FALSE) %>%\n      hc_add_series(name=citylist2[21],data = y$v, visible = FALSE) %>%\n      hc_add_series(name=citylist2[22],data = y$w, visible = FALSE)\n\n  })\n}\n\nshinyApp(ui, server)\n",
    "created" : 1474581986405.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "104706525",
    "id" : "F3C62C2A",
    "lastKnownWriteTime" : 1474628554,
    "last_content_update" : 1474628554426,
    "path" : "C:/Github/ems_case/app.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}